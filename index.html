<!DOCTYPE html>
<html>
<head>
<title>Office Outing Dashboard</title>
<style>
body { font-family: Arial, sans-serif; margin: 20px; }
input, select, button { margin: 5px; padding: 5px; }
</style>
</head>
<body>

<h1>Office Outing Dashboard</h1>
<p>Hey everyone, weâ€™ll be visiting <strong>Nature Trails Resort</strong>. 
Check out their <a href="https://www.naturetrails.in/" target="_blank">website</a> 
and <a href="https://maps.app.goo.gl/4D3tUzZerDj7rniG6" target="_blank">Google Map location</a>.</p>

<h2>Create Carpool Group (For Car Owners)</h2>
<input type="text" id="ownerName" placeholder="Car Owner's Name">
<input type="text" id="from" placeholder="From">
<input type="text" id="to" placeholder="To">
<input type="text" id="trigram" placeholder="Trigram">
<input type="text" id="phone" placeholder="Phone Number">
<input type="number" id="seatsAvailable" placeholder="Seats Available">
<button onclick="createGroup()">Create Car Pool Group</button>

<h2>Request to Join a Car Pool Group</h2>
<input type="text" id="requestorName" placeholder="Your Name">
<input type="text" id="reqTrigram" placeholder="Your Trigram">
<input type="text" id="reqPhone" placeholder="Your Phone Number">
<input type="text" id="targetGroup" placeholder="Car Owner's Name to Join">
<p><b>Kindly connect with the group owner on their mobile number or on their trigram through platform conversations before joining their group</b></p>
<button onclick="joinGroup()">Request to Join</button>

<h2>Available Carpool Groups</h2>
<table border="1" id="groupTable">
<thead>
<tr>
<th>Car Owner's Name</th><th>From</th><th>To</th><th>Trigram</th><th>Phone</th><th>Seats Available</th>
</tr>
</thead>
<tbody></tbody>
</table>

<script>
const WEB_APP_URL = "https://script.google.com/macros/s/AKfycbzkH_nmSwCt2LtMKlfgCmOxQeST8Lc7N4RKOH9lAQMazrZaknkGky-T49PZVWb4MGD3/exec";

function createGroup() {
  const payload = {
    action: "createGroup",
    ownerName: document.getElementById("ownerName").value,
    from: document.getElementById("from").value,
    to: document.getElementById("to").value,
    trigram: document.getElementById("trigram").value,
    phone: document.getElementById("phone").value,
    seatsAvailable: document.getElementById("seatsAvailable").value
  };

  fetch(WEB_APP_URL, {
    method: "POST",
    body: JSON.stringify(payload)
  })
  .then(res => res.json())
  .then(data => {
    if (data.status === "success") {
      alert("Group created successfully!");
      loadGroups();
    } else {
      alert("Error: " + data.message);
    }
  });
}

function joinGroup() {
  const payload = {
    action: "joinGroup",
    requestorName: document.getElementById("requestorName").value,
    trigram: document.getElementById("reqTrigram").value,
    phone: document.getElementById("reqPhone").value,
    targetGroup: document.getElementById("targetGroup").value
  };

  fetch(WEB_APP_URL, {
    method: "POST",
    body: JSON.stringify(payload)
  })
  .then(res => res.json())
  .then(data => {
    if (data.status === "success") {
      alert("Join request sent!");
    } else {
      alert("Error: " + data.message);
    }
  });
}

function loadGroups() {
  const payload = { action: "getGroups" };
  fetch(WEB_APP_URL, {
    method: "POST",
    body: JSON.stringify(payload)
  })
  .then(res => res.json())
  .then(data => {
    if (data.status === "success") {
      const tbody = document.querySelector("#groupTable tbody");
      tbody.innerHTML = "";
      data.data.slice(1).forEach(row => {
        let tr = document.createElement("tr");
        row.forEach(cell => {
          let td = document.createElement("td");
          td.textContent = cell;
          tr.appendChild(td);
        });
        tbody.appendChild(tr);
      });
    }
  });
}

loadGroups();
</script>

</body>
</html>
