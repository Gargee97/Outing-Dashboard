<!DOCTYPE html>
<html>
<head>
  <title>Office Outing Dashboard</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    h2 { color: #2c3e50; }
    form { margin-bottom: 30px; border: 1px solid #ccc; padding: 15px; border-radius: 5px; }
    label { display: block; margin-top: 10px; }
    input, select, button { padding: 8px; margin-top: 5px; width: 100%; }
    table { width: 100%; border-collapse: collapse; margin-top: 20px; }
    th, td { border: 1px solid #ddd; padding: 8px; text-align: center; }
    th { background-color: #f4f4f4; }
    b { display: block; margin-top: 5px; }
    p { margin-top: -10px; }
  </style>
</head>
<body>

  <h1>ðŸŽ‰ Office Outing Dashboard</h1>
  <p>
    Hey everyone! Weâ€™ll be visiting <b>Nature Trails Resort</b> for our office outing. 
    You can check out more details on their 
    <a href="https://www.naturetrails.in/" target="_blank">website</a> or view the 
    <a href="https://maps.app.goo.gl/4D3tUzZerDj7rniG6" target="_blank">Google Map location here</a>.
  </p>

  <h2>Create Carpool Group</h2>
  <form id="groupForm">
    <label>Group Name (Owner):</label>
    <input type="text" id="groupName" required>
    <label>Trigram:</label>
    <input type="text" id="groupTrigram" required>
    <label>Phone Number:</label>
    <input type="text" id="groupPhone" required>
    <label>Route From:</label>
    <input type="text" id="routeFrom" required>
    <label>Route To:</label>
    <input type="text" id="routeTo" required>
    <label>Total Seats in your car:</label>
    <input type="number" id="seats" required>
    <label>Return Type:</label>
    <select id="groupReturnType">
      <option value="Same Day">Same Day</option>
      <option value="Overnight">Overnight</option>
    </select>
    <button type="submit">Create Group</button>
  </form>

  <h2>Available Carpool Groups</h2>
  <table id="groupsTable">
    <thead>
      <tr>
        <th>Owner</th>
        <th>Trigram</th>
        <th>Phone</th>
        <th>Route</th>
        <th>Total Seats</th>
        <th>Remaining Seats</th>
        <th>Return Type</th>
        <th>Members</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <h2>Request to Join a Group</h2>
  <form id="requestForm">
    <label>Your Name:</label>
    <input type="text" id="requestName" required>
    <label>Group Name (Owner from the above list):</label>
    <input type="text" id="requestGroup" required>
    <b>Kindly connect with the group owner on their mobile number or trigram before joining their group</b>
    <button type="submit">Request to Join</button>
  </form>

<script>
const webAppUrl = "https://script.google.com/macros/s/AKfycbx00zVcAuosi8ldpQLxGINACFozafaYQrd1jRZFFwG6bp_9BoxsPUoP8ilgezOjfwbthg/exec"; // Replace with your deployed Web App URL

async function fetchGroups() {
  const res = await fetch(webAppUrl);
  const data = await res.json();
  const tbody = document.querySelector('#groupsTable tbody');
  tbody.innerHTML = '';
  data.forEach(group => {
    const remainingSeats = group["Remaining Seats"];
    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td>${group["Group Name (Owner)"]}</td>
      <td>${group["Trigram"]}</td>
      <td>${group["Phone Number"]}</td>
      <td>${group["Route"]}</td>
      <td>${group["Total Seats"]}</td>
      <td>${remainingSeats}</td>
      <td>${group["Return Type"]}</td>
      <td>${group["Members"]}</td>
    `;
    tbody.appendChild(tr);
  });
}

document.getElementById('groupForm').addEventListener('submit', async function(e){
  e.preventDefault();
  const owner = document.getElementById('groupName').value;
  const trigram = document.getElementById('groupTrigram').value;
  const phone = document.getElementById('groupPhone').value;
  const routeFrom = document.getElementById('routeFrom').value;
  const routeTo = document.getElementById('routeTo').value;
  const seats = parseInt(document.getElementById('seats').value);
  const returnType = document.getElementById('groupReturnType').value;

  await fetch(webAppUrl, {
    method: "POST",
    body: JSON.stringify({
      type: "create",
      owner,
      trigram,
      phone,
      routeFrom,
      routeTo,
      seats,
      returnType
    })
  });

  this.reset();
  fetchGroups();
});

document.getElementById('requestForm').addEventListener('submit', async function(e){
  e.preventDefault();
  const name = document.getElementById('requestName').value;
  const groupOwner = document.getElementById('requestGroup').value;

  const res = await fetch(webAppUrl, {
    method: "POST",
    body: JSON.stringify({type: "join", name, groupOwner})
  });

  const result = await res.json();
  if(result.status === "full") alert("No seats available in this group!");
  else alert(`${name} successfully joined ${groupOwner}'s group!`);

  this.reset();
  fetchGroups();
});

// Fetch groups on page load
fetchGroups();
</script>

</body>
</html>

